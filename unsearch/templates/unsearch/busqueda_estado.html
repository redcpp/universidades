{% extends "unsearch/parts/base.html" %}
{% load staticfiles %}
{% load my_tags %}

{% block nav-global %}
	{% include "unsearch/parts/navbar.html" %}
{% endblock nav-global %}

{% block content %}
<div class="bg-estado">
	<div id="bloque-estado" class="simple-blur vertical-flex">
		<div class="fn-center">
			<div class="draw-circle vertical-flex">
				<img src="{{MEDIA_URL}}{{estado.imagen.url}}" alt="{{MEDIA_URL}}{{estado.imagen.url}}" class="estado-img">
			</div>
			<h1 class="b-title uk-margin-remove">{{estado}}</h1>
		</div>
	</div>
</div>
<div class="uk-grid" id="estado-stats" data-uk-grid-match>
	<a class="uk-width-1-1 estado-section" href="{% url 'unsearch:estado' pk=estado.pk %}">
		<div class="uk-panel uk-text-center vertical-flex">
			<div class="uk-panel-title"><i class="uk-icon-chevron-left"></i> Ver todas las universidades</div>
		</div>
	</a>
</div>
<div id="buscador-estado">
	<form class="uk-form" method="POST">
		{% csrf_token %}
		<div class="uk-form-row">
			<input class="uk-form-large" autofocus name="busqueda" value="{{busqueda}}" onfocus="this.value = this.value;" placeholder="Buscar carrera en {{estado}}">
		</div>
	</form>
</div>

{% regroup universidades by tipo as tipo_list %}

<div class="bloque-contenido" id="lista-universidades">	
	<!-- Accordion -->
	<div class="uk-accordion tarjetas" data-uk-accordion="{collapse: false}">
		{% for tipo in tipo_list %}
		<button class="uk-accordion-title intense">
			<span class="pr-5">{{tipo.grouper}}</span>
			<span class="uk-text-small uk-hidden-small">Coincidencias: <b>{{tipo.list|length}}</b></span>
		</button>
		<div class="uk-accordion-content">
			{% regroup tipo.list by nombre as list_universidades %}
			<div class="uk-grid uk-grid-margin uk-flex uk-flex-center" data-uk-grid-match="{target:'.tarjeta'}">
				{% for universidad in list_universidades|ordenar_matches %}
				<div class="uk-width-medium-1-2 uk-margin-bottom">
					<article class="uk-comment tarjeta shadow-2">
						<a class="uk-comment-header" href="{% url 'unsearch:universidad' pk=universidad.list.0.pk %}">
							<h4 class="uk-comment-title uk-margin-bottom">{{universidad.grouper|title}}</h4>
						</a>
						<div class="uk-comment-body">
							{% for resultado in universidad.list|dictsort:"matches" %}
								<p>{{resultado.matches}}</p>
							{% endfor %}
						</div>
					</article>
				</div>
				{% endfor %}
			</div>
		</div>
		{% endfor %}
	</div>
</div>

{% endblock content %}